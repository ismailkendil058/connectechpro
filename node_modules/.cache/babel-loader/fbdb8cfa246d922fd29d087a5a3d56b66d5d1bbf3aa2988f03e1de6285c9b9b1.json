{"ast":null,"code":"import React,{createContext,useContext,useEffect,useState}from'react';import{auth,db}from'../services/supabaseClient';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export const useAuth=()=>{const context=useContext(AuthContext);if(!context){throw new Error('useAuth must be used within an AuthProvider');}return context;};export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[profile,setProfile]=useState(null);const[loading,setLoading]=useState(true);useEffect(()=>{// Get initial user\nconst getInitialUser=async()=>{try{const currentUser=await auth.getCurrentUser();if(currentUser){setUser(currentUser);await loadUserProfile(currentUser.id);}}catch(error){console.error('Error getting initial user:',error);}finally{setLoading(false);}};getInitialUser();// Listen for auth changes\nconst{data:{subscription}}=auth.onAuthStateChange(async(event,session)=>{if(event==='SIGNED_IN'&&session!==null&&session!==void 0&&session.user){setUser(session.user);await loadUserProfile(session.user.id);}else if(event==='SIGNED_OUT'){setUser(null);setProfile(null);}setLoading(false);});return()=>subscription===null||subscription===void 0?void 0:subscription.unsubscribe();},[]);const loadUserProfile=async userId=>{try{const{data,error}=await db.getUserProfile(userId);if(error){console.error('Error loading user profile:',error);return;}setProfile(data);}catch(error){console.error('Error loading user profile:',error);}};const signUp=async function(email,password){let role=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'student';try{const{data,error}=await auth.signUp(email,password,role);if(error)throw error;return{data,error:null};}catch(error){return{data:null,error};}};const signIn=async(email,password)=>{try{const{data,error}=await auth.signIn(email,password);if(error)throw error;return{data,error:null};}catch(error){return{data:null,error};}};const signOut=async()=>{try{const{error}=await auth.signOut();if(error)throw error;return{error:null};}catch(error){return{error};}};const updateProfile=async updates=>{if(!user)return{error:new Error('No user logged in')};try{const{data,error}=await db.updateUserProfile(user.id,updates);if(error)throw error;// Update local profile state\nsetProfile(prev=>({...prev,...updates}));return{data,error:null};}catch(error){return{data:null,error};}};const value={user,profile,loading,signUp,signIn,signOut,updateProfile,isAuthenticated:!!user,isAdmin:(profile===null||profile===void 0?void 0:profile.role)==='admin',isStudent:(profile===null||profile===void 0?void 0:profile.role)==='student'};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});};","map":{"version":3,"names":["React","createContext","useContext","useEffect","useState","auth","db","jsx","_jsx","AuthContext","useAuth","context","Error","AuthProvider","_ref","children","user","setUser","profile","setProfile","loading","setLoading","getInitialUser","currentUser","getCurrentUser","loadUserProfile","id","error","console","data","subscription","onAuthStateChange","event","session","unsubscribe","userId","getUserProfile","signUp","email","password","role","arguments","length","undefined","signIn","signOut","updateProfile","updates","updateUserProfile","prev","value","isAuthenticated","isAdmin","isStudent","Provider"],"sources":["C:/Users/admin/Desktop/connectechpro/src/contexts/AuthContext.js"],"sourcesContent":["import React, { createContext, useContext, useEffect, useState } from 'react';\r\nimport { auth, db } from '../services/supabaseClient';\r\n\r\nconst AuthContext = createContext();\r\n\r\nexport const useAuth = () => {\r\n  const context = useContext(AuthContext);\r\n  if (!context) {\r\n    throw new Error('useAuth must be used within an AuthProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [user, setUser] = useState(null);\r\n  const [profile, setProfile] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    // Get initial user\r\n    const getInitialUser = async () => {\r\n      try {\r\n        const currentUser = await auth.getCurrentUser();\r\n        if (currentUser) {\r\n          setUser(currentUser);\r\n          await loadUserProfile(currentUser.id);\r\n        }\r\n      } catch (error) {\r\n        console.error('Error getting initial user:', error);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    getInitialUser();\r\n\r\n    // Listen for auth changes\r\n    const { data: { subscription } } = auth.onAuthStateChange(async (event, session) => {\r\n      if (event === 'SIGNED_IN' && session?.user) {\r\n        setUser(session.user);\r\n        await loadUserProfile(session.user.id);\r\n      } else if (event === 'SIGNED_OUT') {\r\n        setUser(null);\r\n        setProfile(null);\r\n      }\r\n      setLoading(false);\r\n    });\r\n\r\n    return () => subscription?.unsubscribe();\r\n  }, []);\r\n\r\n  const loadUserProfile = async (userId) => {\r\n    try {\r\n      const { data, error } = await db.getUserProfile(userId);\r\n      if (error) {\r\n        console.error('Error loading user profile:', error);\r\n        return;\r\n      }\r\n      setProfile(data);\r\n    } catch (error) {\r\n      console.error('Error loading user profile:', error);\r\n    }\r\n  };\r\n\r\n  const signUp = async (email, password, role = 'student') => {\r\n    try {\r\n      const { data, error } = await auth.signUp(email, password, role);\r\n      if (error) throw error;\r\n      return { data, error: null };\r\n    } catch (error) {\r\n      return { data: null, error };\r\n    }\r\n  };\r\n\r\n  const signIn = async (email, password) => {\r\n    try {\r\n      const { data, error } = await auth.signIn(email, password);\r\n      if (error) throw error;\r\n      return { data, error: null };\r\n    } catch (error) {\r\n      return { data: null, error };\r\n    }\r\n  };\r\n\r\n  const signOut = async () => {\r\n    try {\r\n      const { error } = await auth.signOut();\r\n      if (error) throw error;\r\n      return { error: null };\r\n    } catch (error) {\r\n      return { error };\r\n    }\r\n  };\r\n\r\n  const updateProfile = async (updates) => {\r\n    if (!user) return { error: new Error('No user logged in') };\r\n    \r\n    try {\r\n      const { data, error } = await db.updateUserProfile(user.id, updates);\r\n      if (error) throw error;\r\n      \r\n      // Update local profile state\r\n      setProfile(prev => ({ ...prev, ...updates }));\r\n      return { data, error: null };\r\n    } catch (error) {\r\n      return { data: null, error };\r\n    }\r\n  };\r\n\r\n  const value = {\r\n    user,\r\n    profile,\r\n    loading,\r\n    signUp,\r\n    signIn,\r\n    signOut,\r\n    updateProfile,\r\n    isAuthenticated: !!user,\r\n    isAdmin: profile?.role === 'admin',\r\n    isStudent: profile?.role === 'student',\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={value}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n}; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}